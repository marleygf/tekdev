/*!
 * =============================
 * =	Mike Pinto             =
 * =	mspkvp@github.com      =
 * =	Â©2017 tk7movespretty   =
 * ============================= */
"use strict";function getCookie(){if(void 0!==Cookies.get("tk7moves")){d3.select("#platf-select > option:nth-child("+(bl_choice+1)+")").attr("selected",!1),d3.select("#lang-select > option:nth-child("+(lang_index+1)+")").attr("selected",!1);var e=JSON.parse(Cookies.get("tk7moves"));selected_char=e.selected_char,lang=e.lang,lang_index=e.lang_index,jap=e.jap,bl_choice=e.bl_choice,d3.select("#platf-select > option:nth-child("+(bl_choice+1)+")").attr("selected",!0),d3.select("#lang-select > option:nth-child("+(lang_index+1)+")").attr("selected",!0)}else setCookie()}function setCookie(){Cookies.set("tk7moves",JSON.stringify({selected_char:selected_char,lang:lang,lang_index:lang_index,jap:jap,bl_choice:bl_choice}),{expires:30,path:""})}function isLetter(e){return e.toLowerCase()!=e.toUpperCase()}function toHexArr(e){for(var t=[],s=0;s<e.length;s++)t.push("\\u"+e.charCodeAt(s).toString(16));return t}function setLang(e){lang=parseInt(e),jap=0===lang,d3.select("#lang-select").selectAll("option").each(function(){parseInt(this.value)===lang&&(lang_index=this.index)}),setCookie(),fetchmovelist(selected_char)}function selectChar(e){d3.select(".move-table").remove(),d3.select(".char-movelist .inner-table").html('<table class="move-table"></table>');var t=char_data[selected_char].c.split(" ");d3.select("#"+t[0]).classed("selected",!1),t=char_data[selected_char=e].c.split(" "),d3.select("#"+t[0]).classed("selected",!0),d3.select("#selected-title").text(char_data[selected_char].n),setCookie(),charMenuDialog&&toggleCharMenu()}var char_data=[],ctrls_map,hits_map=[],selected_char="32",lang=1,lang_index=0,jap=!1,prefDialog=!1,charMenuDialog=!1,button_layouts=["STEAM","PS4","XBOX"],bl_choice=2;String.prototype.hexEncode=function(){var e,t="";for(e=0;e<this.length;e++)t+=("000"+this.charCodeAt(e).toString(16)).slice(-4);return t},String.prototype.hexDecode=function(){var e,t=this.match(/.{1,4}/g)||[],s="";for(e=0;e<t.length;e++)s+=String.fromCharCode(parseInt(t[e],16));return s};var togglePreferences=function(){prefDialog?d3.select("#preferences").style("visibility","hidden"):d3.select("#preferences").style("visibility","visible"),prefDialog=!prefDialog},toggleCharMenu=function(){charMenuDialog?d3.select("#charmenu").style("display","none"):d3.select("#charmenu").style("display","initial"),charMenuDialog=!charMenuDialog},changePlatform=function(e){bl_choice=e,setCookie(),fetchmovelist(selected_char)},importdata=function(){getCookie(),d3.json("./assets/data/map_hits.json",function(e,t){for(var s in t)hits_map[t[s].i]=t[s].h;d3.json("./assets/data/map_ctrls.json",function(e,t){ctrls_map=t,d3.json("./assets/data/map_chars.json",function(e,t){for(var s in t)char_data[t[s].i]={c:t[s].c,n:t[s].n};for(let e=0;e<t.length;e++){var a=t[e].c_index.split(" ");"11"==t[e].i&&(a=t[e].c.split("-")),d3.select(".char-menu > .inner-table > table").append("tr").html('<td class="char-card" id="'+t[e].c.split(" ")[0]+'"><img src="./assets/chars/'+a.join("").toLowerCase()+'_thumbnail.png"><p>'+t[e].c+"</p></td>"),d3.select("#"+t[e].c.split(" ")[0]).on("click",function(){fetchmovelist(t[e].i)})}var l=char_data[selected_char].c.split(" ");d3.select("#"+l[0]).classed("selected",!0),d3.select("#selected-title").text(char_data[selected_char].n),fetchmovelist(selected_char)})})})},fetchmovelist=function(e){d3.json("./assets/data/movelists/MOVELIST_"+e+".json",function(t,s){selectChar(e);var a=0;for(let t=0;t<s.moves.length;t++){if(!s.moves[t].number>0){let e='<td class="move-card"><div class="move-info"><div class="move-number">&#9733;</div><div class="move-title"><div class="move-name" style="margin-bottom:5px;">'+s.moves[t].name[jap?0:1]+"</div></div></div></td>";d3.select(".move-table").append("tr").html(e);continue}a++;var l='<td class="move-card"><div class="move-info"><div class="move-number">'+s.moves[t].number+'</div><div class="move-title"><div class="move-name">'+s.moves[t].name[jap?0:1]+'</div><div class="move-hitamount">'+s.moves[t].ds.length+(s.moves[t].ds.length>1?" Hits":" Hit")+"</div></div>";l+='<div class="move-string">';let c=s.moves[t].command[lang].split(" ");for(let e=0;e<c.length;e++)if(/[a-z]/.test(c[e].toLowerCase()))l+='<p class="move-hint">'+c[e]+"</p>";else for(let t=0;t<c[e].length;t++)try{isLetter(ctrls_map[c[e].charAt(t)])?ctrls_map[c[e].charAt(t)]===ctrls_map[c[e].charAt(t)].toLowerCase()||"N"===ctrls_map[c[e].charAt(t)]?l+='<img class="move-arrow" src="./assets/arrow/'+ctrls_map[c[e].charAt(t)].toLowerCase()+'.svg">':l+='<img class="move-arrow" src="./assets/arrow/'+ctrls_map[c[e].charAt(t)].toLowerCase()+'p.svg">':isNaN(ctrls_map[c[e].charAt(t)].charAt(0))?">"===ctrls_map[c[e].charAt(t)]?l+='<p class="move-hint" style="color:#37ff05;font-size:20px;"><i class="fa fa-chevron-right" aria-hidden="true"></i></p>':(console.log("1. Not added: "+c[e].charAt(t)),console.log("2. Not added map: "+ctrls_map[c[e].charAt(t)])):l+='<img class="move-button" src="./assets/button/'+button_layouts[bl_choice]+"/"+ctrls_map[c[e].charAt(t)]+'.svg">'}catch(s){"("===c[e].charAt(t)||c[e].charAt(t),l+='<p class="move-hint">'+c[e].charAt(t)+"</p>"}l+='</div><div class="move-hit-dmg"><div class="move-hitlvlstring">';for(let a=0;a<s.moves[t].at.length;a++){try{l+='<p class="mv-hitlvl hit'+hits_map[s.moves[t].at[a].l].toLowerCase()+'">'+hits_map[s.moves[t].at[a].l]+(s.moves[t].at[a].t>0?" Throw":"")+"</p>"}catch(l){throw console.log(s.moves[t].at[a].l),console.log(hits_map[s.moves[t].at[a].l]),console.log("Fighter: "+e),console.log(s.moves[t].number),l}a+1<s.moves[t].at.length&&(l+='<i class="fa fa-chevron-right" aria-hidden="true"></i>')}if(s.moves[t].br.length>0){let e="";switch(s.moves[t].br[0].b){case 1:e="1";break;case 2:e="2";break;case 3:e="1/2";break;case 4:e="1+2";break;default:e=""}l+='<i class="fa fa-caret-right" aria-hidden="true"></i>',l+='<p class="mv-hitlvl">'+s.moves[t].br[0].f+"F BREAK "+e+"</p>"}l+="</div>",l+='<div class="move-dmg"><p class="mv-frames">'+s.moves[t].d+'</p><p class="mv-id">Damage</p><div class="move-hitdmg-section"><i id="dmgmove'+s.moves[t].number+'" class="fa fa-plus-square" aria-hidden="true"></i><div class="move-hitdmg">';for(let e=0;e<s.moves[t].ds.length;e++)l+=s.moves[t].ds[e].d,e+1<s.moves[t].ds.length&&(l+="+");if(l+="</div></div></div></div></div>",l+='<div class="move-extra"><div class="mv-section"><div class="move-special">',s.moves[t].b9&&(l+='<p class="spin">SPIN</p>'),s.moves[t].b8&&(l+='<p class="armor">ARMOR</p>'),s.moves[t].bB&&(l+='<p class="track">TRACK</p>'),l+="</div>",l+='<table class="move-frames"><tr class="move-startf"><td class="mv-id">Start</td><td class="mv-frames">'+s.moves[t].s+"F</td></tr>",s.moves[t].s>0){l+='<tr class="move-startf-seg"><td>'+s.moves[t].s+"F = ";for(var o=1;o<s.moves[t].ss.length;o++)l+=s.moves[t].ss[o].s,o+1<s.moves[t].ss.length&&(l+="+");l+="</td></tr>"}l+='<tr class="move-blockf"><td class="mv-id">Block</td><td class="mv-frames '+(s.moves[t].blk>-1?'blkpositive">+':s.moves[t].blk<-10?'blknegative">':'blkmild">')+s.moves[t].blk+"</td></tr>",l+='<tr class="move-hitf"><td class="mv-id">Hit</td><td class="mv-frames">'+(s.moves[t].adv>0?"+"+s.moves[t].adv:s.moves[t].adv)+"</td></tr></table>",l+="</div>",l+="</div></td>",d3.select(".move-table").append("tr").html(l)}for(var c=1;c<=a;c++){var i=c;d3.select("#dmgmove"+i).on("mouseenter",function(){d3.select("i#"+this.id+" + div.move-hitdmg").style("display","initial")}),d3.select("#dmgmove"+c).on("mouseleave",function(){var e=this.id;setTimeout(function(){d3.select("i#"+e+" + div.move-hitdmg").style("display","none")},3e3)})}document.querySelector("#movelist_tab > table ").firstElementChild.scrollIntoView(!0)})};